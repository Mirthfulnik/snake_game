<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ó–º–µ–π–∫–∞ ‚Äî 10 —É—Ä–æ–≤–Ω–µ–π</title>
  <style>
    :root { --bg:#0f1115; --panel:#171a21; --accent:#4ade80; --danger:#ef4444; --muted:#9ca3af; }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; background:var(--bg); color:#e5e7eb; display:grid; place-items:center; min-height:100vh}
    .wrap{display:grid; gap:14px; padding:16px; width:min(680px, 96vw)}
    canvas{background:#0a0c10; border:2px solid #222630; border-radius:14px; width:100%; height:auto}
    .hud{display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; align-items:center}
    .hud .badge{background:var(--panel); padding:10px 12px; border-radius:12px; text-align:center}
    .hud .badge strong{color:#fff}
    .controls{display:flex; gap:10px; flex-wrap:wrap}
    button{background:var(--panel); color:#fff; border:1px solid #2a2f3a; border-radius:12px; padding:10px 14px; cursor:pointer}
    button:hover{border-color:#3a4150}
    .note{color:var(--muted); font-size:14px}
    .overlay{position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.55)}
    .overlay.show{display:grid}
    .card{background:var(--panel); padding:18px; border-radius:14px; width:min(520px, 92vw)}
    .card h2{margin:0 0 8px}
    .levels{display:flex; gap:6px; flex-wrap:wrap; margin-top:8px}
    .lvl{padding:6px 8px; border-radius:10px; border:1px solid #2a2f3a; font-size:13px}
    .lvl.active{background:var(--accent); color:#062c1f; border-color:transparent}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hud">
      <div class="badge">–£—Ä–æ–≤–µ–Ω—å: <strong id="level">1</strong></div>
      <div class="badge">–°—á—ë—Ç: <strong id="score">0</strong></div>
      <div class="badge">–°–∫–æ—Ä–æ—Å—Ç—å: <strong id="speed">150ms</strong></div>
    </div>
    <canvas id="game" width="600" height="600" aria-label="–ü–æ–ª–µ –∏–≥—Ä—ã '–ó–º–µ–π–∫–∞'" role="img"></canvas>
    <div class="controls">
      <button id="start">‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç / –ü–∞—É–∑–∞</button>
      <button id="restart">üîÑ –†–µ—Å—Ç–∞—Ä—Ç</button>
      <button id="toggleGrid"># –°–µ—Ç–∫–∞</button>
      <span class="note">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: —Å—Ç—Ä–µ–ª–∫–∏ –∏–ª–∏ WASD. –ó–∞ –∫–∞–∂–¥—ã–µ 5 –æ—á–∫–æ–≤ ‚Üë —É—Ä–æ–≤–µ–Ω—å (–¥–æ 10). –° –∫–∞–∂–¥—ã–º —É—Ä–æ–≤–Ω–µ–º ‚Üë —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è.</span>
    </div>
    <div class="levels" id="levelBadges"></div>
  </div>

  <div class="overlay" id="overlay">
    <div class="card">
      <h2 id="overlayTitle">–ó–º–µ–π–∫–∞</h2>
      <p id="overlayText">–ù–∞–±–µ—Ä–∏—Ç–µ –±–æ–ª—å—à–µ –æ—á–∫–æ–≤ –∏ –¥–æ–π–¥–∏—Ç–µ –¥–æ 10 —É—Ä–æ–≤–Ω—è! –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å–æ —Å—Ç–µ–Ω–∞–º–∏, —Å–æ–±–æ–π –∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç –∏–≥—Ä—É.</p>
      <div style="display:flex; gap:10px; margin-top:10px">
        <button id="playBtn">–ò–≥—Ä–∞—Ç—å</button>
        <button id="closeOverlay">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

<script>
(() => {
  // --- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø–æ–ª—è
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const COLS = 30, ROWS = 30;         // —Å–µ—Ç–∫–∞ 30x30
  const CELL = canvas.width / COLS;   // —Ä–∞–∑–º–µ—Ä –∫–ª–µ—Ç–∫–∏
  const MAX_LEVEL = 10;
  const BASE_SPEED = 150;             // –º—Å –Ω–∞ —Ç–∏–∫, —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è —Å —É—Ä–æ–≤–Ω–µ–º
  const SPEED_STEP = 10;              // –Ω–∞ —Å–∫–æ–ª—å–∫–æ —É—Å–∫–æ—Ä—è–µ–º—Å—è –∑–∞ —É—Ä–æ–≤–µ–Ω—å
  const OBSTACLE_STEP = 4;            // +—Å–∫–æ–ª—å–∫–æ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –∑–∞ —É—Ä–æ–≤–µ–Ω—å

  // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
  let snake, dir, nextDir, food, obstacles, score, level, timer, running, showGrid;

  // --- UI
  const levelEl = document.getElementById('level');
  const scoreEl = document.getElementById('score');
  const speedEl = document.getElementById('speed');
  const startBtn = document.getElementById('start');
  const restartBtn = document.getElementById('restart');
  const toggleGridBtn = document.getElementById('toggleGrid');
  const overlay = document.getElementById('overlay');
  const overlayTitle = document.getElementById('overlayTitle');
  const overlayText = document.getElementById('overlayText');
  const playBtn = document.getElementById('playBtn');
  const closeOverlay = document.getElementById('closeOverlay');
  const levelBadges = document.getElementById('levelBadges');

  for (let i = 1; i <= MAX_LEVEL; i++) {
    const b = document.createElement('span');
    b.className = 'lvl' + (i===1 ? ' active' : '');
    b.textContent = 'L' + i;
    levelBadges.appendChild(b);
  }

  function setBadgeActive(lvl){
    [...levelBadges.children].forEach((el, idx) => {
      el.classList.toggle('active', idx+1 === lvl);
    });
  }

  // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ
  const randInt = (min, max) => Math.floor(Math.random()*(max-min+1))+min;
  const eq = (a,b) => a.x===b.x && a.y===b.y;
  const inSnake = (cell) => snake.some(s => eq(s, cell));
  const inObstacles = (cell) => obstacles.some(o => eq(o, cell));

  function speedForLevel(l){
    // —Å–∫–æ—Ä–æ—Å—Ç—å —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –Ω–∏–∂–µ 60–º—Å
    return Math.max(60, BASE_SPEED - (l-1)*SPEED_STEP);
  }
  function obstacleCountForLevel(l){
    return Math.max(0, (l-1) * OBSTACLE_STEP);
  }
  function levelForScore(sc){
    return Math.min(MAX_LEVEL, Math.floor(sc/5)+1); // +—É—Ä–æ–≤–µ–Ω—å –∫–∞–∂–¥—ã–µ 5 –æ—á–∫–æ–≤
  }

  function placeRandomFreeCell(){
    let c;
    do {
      c = { x: randInt(0, COLS-1), y: randInt(0, ROWS-1) };
    } while (inSnake(c) || inObstacles(c) || (food && eq(food, c)));
    return c;
  }

  function spawnFood(){
    food = placeRandomFreeCell();
  }
  function buildObstacles(){
    obstacles = [];
    const count = obstacleCountForLevel(level);
    for (let i=0;i<count;i++) obstacles.push(placeRandomFreeCell());
  }

  function reset(){
    score = 0; level = 1; setBadgeActive(level);
    snake = [ {x:Math.floor(COLS/2), y:Math.floor(ROWS/2)}, {x:Math.floor(COLS/2)-1, y:Math.floor(ROWS/2)}, {x:Math.floor(COLS/2)-2, y:Math.floor(ROWS/2)} ];
    dir = {x:1,y:0}; nextDir = {x:1,y:0};
    obstacles = [];
    spawnFood();
    buildObstacles();
    showGrid = false;
    running = false;
    updateHUD();
    draw();
  }

  function updateHUD(){
    levelEl.textContent = level;
    scoreEl.textContent = score;
    speedEl.textContent = speedForLevel(level) + 'ms';
    setBadgeActive(level);
  }

  function startPause(){
    if (running){
      running = false; clearInterval(timer);
    } else {
      running = true; scheduleTick();
    }
  }

  function scheduleTick(){
    clearInterval(timer);
    timer = setInterval(tick, speedForLevel(level));
  }

  function gameOver(){
    running = false; clearInterval(timer);
    overlayTitle.textContent = '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞';
    overlayText.textContent = `–í–∞—à —Å—á—ë—Ç: ${score}. –î–æ—Å—Ç–∏–≥–Ω—É—Ç —É—Ä–æ–≤–µ–Ω—å ${level}.`;
    overlay.classList.add('show');
  }

  function maybeLevelUp(){
    const newLevel = levelForScore(score);
    if (newLevel !== level){
      level = newLevel; buildObstacles(); updateHUD();
      if (running) scheduleTick();
    }
  }

  function tick(){
    // –ø—Ä–∏–º–µ–Ω—è–µ–º –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–µ —Å–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –Ω–∞ 180¬∞ –∑–∞ –æ–¥–∏–Ω –∫–∞–¥—Ä
    dir = nextDir;
    const head = {...snake[0]};
    head.x += dir.x; head.y += dir.y;

    // —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å–æ —Å—Ç–µ–Ω–∞–º–∏
    if (head.x<0 || head.x>=COLS || head.y<0 || head.y>=ROWS) return gameOver();
    // —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å —Å–æ–±–æ–π/–ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
    if (inSnake(head) || inObstacles(head)) return gameOver();

    snake.unshift(head);

    if (eq(head, food)){
      score++; spawnFood(); maybeLevelUp();
    } else {
      snake.pop();
    }

    updateHUD();
    draw();
  }

  function draw(){
    // —Ñ–æ–Ω
    ctx.fillStyle = '#0b0e13';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    if (showGrid){
      ctx.strokeStyle = '#11151d';
      ctx.lineWidth = 1;
      for (let x=1;x<COLS;x++){ ctx.beginPath(); ctx.moveTo(x*CELL,0); ctx.lineTo(x*CELL,canvas.height); ctx.stroke(); }
      for (let y=1;y<ROWS;y++){ ctx.beginPath(); ctx.moveTo(0,y*CELL); ctx.lineTo(canvas.width,y*CELL); ctx.stroke(); }
    }

    // –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
    ctx.fillStyle = '#475569';
    obstacles.forEach(o => rect(o.x,o.y, 6));

    // –µ–¥–∞
    drawFood();

    // –∑–º–µ–π–∫–∞
    drawSnake();
  }

  function rect(cx, cy, pad=4, color){
    const x = cx*CELL + pad/2;
    const y = cy*CELL + pad/2;
    const size = CELL - pad;
    if (color) ctx.fillStyle = color;
    ctx.fillRect(x,y,size,size);
  }

  function drawSnake(){
    // –≥–æ–ª–æ–≤–∞
    rect(snake[0].x, snake[0].y, 2, '#22c55e');
    // —Ç–µ–ª–æ ‚Äî –≥—Ä–∞–¥–∏–µ–Ω—Ç –æ—Ç –∑–µ–ª—ë–Ω–æ–≥–æ –∫ —Ç—ë–º–Ω–æ–º—É
    for (let i=1;i<snake.length;i++){
      const t = i/(snake.length-1 || 1);
      const g = Math.floor(180 - t*100);
      rect(snake[i].x, snake[i].y, 4, `rgb(34, ${g}, 94)`);
    }
  }

  function drawFood(){
    // –µ–¥–∞ ‚Äî –∫—Ä—É–≥–ª–∞—è ¬´—è–≥–æ–¥–∞¬ª
    const cx = food.x*CELL + CELL/2;
    const cy = food.y*CELL + CELL/2;
    const r = CELL*0.35;
    ctx.beginPath();
    ctx.arc(cx, cy, r, 0, Math.PI*2);
    ctx.fillStyle = '#ef4444';
    ctx.fill();
  }

  // --- –°–º–µ–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
  function setDir(nx, ny){
    // –∑–∞–ø—Ä–µ—Ç —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞ –Ω–∞ 180¬∞
    if (running && nx === -dir.x && ny === -dir.y) return;
    nextDir = {x:nx, y:ny};
  }

  window.addEventListener('keydown', (e) => {
    const k = e.key.toLowerCase();
    if (k==='arrowup' || k==='w') setDir(0,-1);
    else if (k==='arrowdown' || k==='s') setDir(0,1);
    else if (k==='arrowleft' || k==='a') setDir(-1,0);
    else if (k==='arrowright' || k==='d') setDir(1,0);
    else if (k===' '){ e.preventDefault(); startPause(); }
  });

  // –ü—Ä–æ—Å—Ç—ã–µ —Ç–∞—á-–∫–æ–Ω—Ç—Ä–æ–ª—ã (—Å–≤–∞–π–ø—ã)
  let touchStart=null;
  canvas.addEventListener('touchstart', (e)=>{ touchStart = e.touches[0]; });
  canvas.addEventListener('touchend', (e)=>{ touchStart=null; });
  canvas.addEventListener('touchmove', (e)=>{
    if (!touchStart) return;
    const t = e.touches[0];
    const dx = t.clientX - touchStart.clientX;
    const dy = t.clientY - touchStart.clientY;
    if (Math.abs(dx)+Math.abs(dy) < 24) return;
    if (Math.abs(dx) > Math.abs(dy)) setDir(Math.sign(dx),0); else setDir(0,Math.sign(dy));
    touchStart = null;
  }, {passive:true});

  // --- –ö–Ω–æ–ø–∫–∏
  startBtn.addEventListener('click', startPause);
  restartBtn.addEventListener('click', () => { reset(); overlay.classList.add('show'); });
  toggleGridBtn.addEventListener('click', () => { showGrid = !showGrid; draw(); });
  playBtn.addEventListener('click', () => { overlay.classList.remove('show'); running=true; scheduleTick(); });
  closeOverlay.addEventListener('click', () => overlay.classList.remove('show'));

  // --- –°—Ç–∞—Ä—Ç
  reset();
  overlay.classList.add('show');
})();
</script>

<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden; /* –∑–∞–ø—Ä–µ—Ç –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
    touch-action: none; /* –æ—Ç–∫–ª—é—á–∞–µ—Ç —Å–∫—Ä–æ–ª–ª –ø—Ä–∏ —Å–≤–∞–π–ø–∞—Ö */
    background: #0b0b0f;
  }
</style>
<script>
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –∫–∞–Ω–≤–∞—Å–∞ –ø–æ–¥ —ç–∫—Ä–∞–Ω
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  // –î–µ–ª–∞–µ–º –∫–∞–Ω–≤–∞—Å —á—É—Ç—å –º–µ–Ω—å—à–µ —ç–∫—Ä–∞–Ω–∞
  const size = Math.min(window.innerWidth, window.innerHeight) - 40;
  canvas.width = size;
  canvas.height = size;
</script>

/* Promo banner */
.promo { margin-top:16px; }
.promo-card{
  background:#0f1420; border:1px solid #1f2a38; border-radius:16px; padding:14px 16px;
  display:flex; align-items:center; gap:12px; justify-content:space-between;
}
.promo-left{ text-align:left }
.promo-title{ font-size:15px; font-weight:800; margin:0 0 2px }
.promo-desc{ font-size:13px; color:var(--muted); margin:0 }
/* –û—Ä–∞–Ω–∂–µ–≤–∞—è –∫–Ω–æ–ø–∫–∞ ¬´–ü–µ—Ä–µ–π—Ç–∏¬ª —Å —á—ë—Ä–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º */
#openChannel{
  background: orange !important;
  color: black !important;
  border: 1px solid #cc8400;
  border-radius:10px;
  padding:10px 14px;
  font-weight:800;
}
#openChannel:hover{ background:#ffb733 }

</body>
</html>


